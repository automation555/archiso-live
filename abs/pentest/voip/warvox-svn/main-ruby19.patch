--- main.old	2009-10-29 19:09:40.718706797 +0100
+++ src/ruby-kissfft/main.c	2009-10-29 19:15:08.629446709 +0100
@@ -78,11 +78,11 @@
 		return Qnil;
 	}
 
-	if(RARRAY(r_data)->len == 0) {
+	if(RARRAY_LEN(r_data) == 0) {
 		return Qnil;
 	}
 
-	if(TYPE(RARRAY(r_data)->ptr[0]) != T_FIXNUM ) {
+	if(TYPE(RARRAY_PTR(r_data)[0]) != T_FIXNUM ) {
 		return Qnil;
 	}	
 
@@ -95,7 +95,7 @@
 
 	memset(mag2buf,0,sizeof(mag2buf)*nfreqs);
 
-	inp_len = RARRAY(r_data)->len;
+	inp_len = RARRAY_LEN(r_data);
 	inp_idx = 0;
 
 	while(inp_idx < inp_len) {
@@ -105,10 +105,10 @@
 			if(inp_idx + i >= inp_len) {
 				tbuf[i] = 0;
 			} else {
-				if(TYPE(RARRAY(r_data)->ptr[ inp_idx + i ]) != T_FIXNUM) {
+				if(TYPE(RARRAY_PTR(r_data)[ inp_idx + i ]) != T_FIXNUM) {
 					tbuf[i] = 0;
 				} else {
-					tbuf[i] = NUM2INT( RARRAY(r_data)->ptr[ inp_idx + i ] );
+					tbuf[i] = NUM2INT( RARRAY_PTR(r_data)[ inp_idx + i ] );
 				}
 			}
 		}
