# Functions used by rc.sysinit
# Modified versions for larch live systems

f_header ()
{
    echo " "
    printhl "Arch Linux $C_OTHER(${C_H2}Core Dump$C_OTHER)\n"
    printhl "${C_H2}http://www.archlinux.org"
    printhl "Copyright 2002-2007 Judd Vinet"
    printhl "Copyright 2007-2008 Aaron Griffin"
    printhl "Distributed under the GNU General Public License (GPL)"
    printsep
}

f_fscheck ()
{
    stat_busy "Initializing /etc/mtab"
    #/bin/mount -n -o remount,rw /

    /bin/rm -f /etc/mtab*

    # Make entries for aufs/unionfs, tmpfs and live medium in /etc/mtab
    grep "^aufs */ " /proc/mounts >>/etc/mtab
    grep "^unionfs */ " /proc/mounts >>/etc/mtab
    grep "^tmpfs */.livesys " /proc/mounts >>/etc/mtab
    if [ -d /bootmnt/archlive.sqfs ]; then
        grep " /bootmnt/archlive.sqfs " /proc/mounts >>/etc/mtab
    fi

    f_mountlocal
    stat_done

    if [ -z "$( cat /etc/fstab | grep "^#KEEP" )" ]; then
        stat_busy "Generating fresh /etc/fstab"
        /opt/larch-live/run/gen_fstab -l
        stat_done
    fi

    # now mount all the local filesystems
    stat_busy "Mounting Local Filesystems"
    /bin/mount -a -t $NETFS
    stat_done
}

f_swapon ()
{
    #+*** Copy session-save flag-file (if it exists)
    [ -f /larch/nosave ] && cp /larch/nosave /.livesys
    #-***

    #*** Conditional swap activation
    if [ -e /.livesys/swapon ]; then
        status "Activating Swap" /sbin/swapon -a
    fi
}
