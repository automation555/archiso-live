# Contributor: Manuel "ekerazha" C. (www.ekerazha.com)
# Contributor: Francesco Piccinno <stack.box@gmail.com>

pkgname=ipw2200-inject
pkgver=1.2.2.2.6.24.3
pkgrel=2
pkgdesc="An open source 802.11a/bg driver for the ipw2200 and ipw2915 with injection patch."
arch=('i686' 'x86_64')
url="http://ipw2200.sourceforge.net"
license=('GPL')
depends=('wireless_tools' 'kernel26>=2.6.28' 'kernel26<2.6.29' 'ipw2200-fw')
install=ipw2200-inject.install
source=(ipw2200-1.2.2.2.6.24.3.tar.gz
        ipw2200_rtap_fix.patch
        http://patches.aircrack-ng.org/ipw2200-1.1.4-inject.patch)
md5sums=('7c29eb66c6117d95b093483a120f3b7b'
         '31937ea17ef7ca7e2238f0055c36fb21'
         '57e8e02fcefee2bef4630f40ea27baf0')
_kernver=2.6.28-ARCH

build() {
  cd $startdir/src/ipw2200-$pkgver
  patch -Np1 -i ../ipw2200_rtap_fix.patch || return 1
  patch -Np1 -i ../ipw2200-1.1.4-inject.patch || return 1
  make KVER=$_kernver IEEE80211_INC=/usr/src/linux-$_kernver/include IEEE80211_IGNORE_DUPLICATE=y || return 1
  install -D -m 644 ipw2200.ko $startdir/pkg/lib/modules/$_kernver/kernel/drivers/net/wireless/ipw2200-inject.ko
}
